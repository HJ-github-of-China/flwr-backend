# 库表设计

**不需要准确率这个字段，这个不是我能手动设置滴**

```sql
CREATE TABLE model(
    model_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '模型ID',
    model_name VARCHAR(100) NOT NULL COMMENT '模型名称',
    model_version VARCHAR(50) DEFAULT '1.0.0' COMMENT '模型版本',
    learning_rate DECIMAL(10,6) COMMENT '学习率',
    epochs INT COMMENT '训练轮次',
    aggregation_strategy VARCHAR(50) COMMENT '聚合策略',
    batch_size INT COMMENT '批次大小',
    optimizer VARCHAR(50) COMMENT '优化器',
    algorithm VARCHAR(100) COMMENT '算法/程序',
    model_status VARCHAR(20) DEFAULT 'training' COMMENT '模型状态: training, completed, failed, stopped',
    model_path VARCHAR(500) COMMENT '模型文件存储路径',
    description TEXT COMMENT '模型描述',
    created_time DATETIME NOT NULL COMMENT '创建时间',
    updated_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    is_deleted TINYINT DEFAULT 0 COMMENT '软删除标记(0-正常,1-删除)',
    UNIQUE KEY uk_model_name_version (model_name, model_version)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='模型仓库表';

-- 创建索引
CREATE INDEX idx_model_status ON model(model_status);
CREATE INDEX idx_created_time ON model(created_time);
CREATE INDEX idx_model_name ON model(model_name);
```

## 插入测试数据

```sql
-- 插入示例数据（对应图片中的模型）
INSERT INTO model (
    model_name, learning_rate, epochs, aggregation_strategy, 
    batch_size, optimizer, algorithm, model_status, created_time
) VALUES 
('实验模型A', 0.0005, 80, 'FedMA', 16, 'SGD', 'DenseNet121', 'training', '2024-06-15 10:00:00'),
('实验模型B', 0.001, 100, 'FedAvg', 32, 'Adam', 'ResNet50', 'completed', '2024-06-14 15:30:00'),
('实验模型C', 0.0001, 50, 'FedProx', 64, 'SGD', 'VGG16', 'training', '2024-06-13 09:20:00');
```

# 📚 模型管理接口文档

## 基础信息

- **基础URL**: `/api`
- **请求格式**: JSON
- **响应格式**: JSON
- **认证方式**: Bearer Token

## 通用响应格式

### 成功响应
```json
{
  "code": 200,
  "message": "success",
  "data": {}
}
```

### 错误响应
```json
{
  "code": 400,
  "message": "错误描述",
  "data": null
}
```

## 1. 创建模型接口

### 接口说明
创建新的联邦学习模型配置

### 请求信息
- **URL**: `POST /api/models`
- **Content-Type**: `application/json`
- **认证**: 需要Bearer Token

### 请求参数
```json
{
  "model_name": "实验模型A",
  "model_version": "1.0.0",
  "learning_rate": 0.001,
  "epochs": 100,
  "aggregation_strategy": "FedAvg",
  "batch_size": 32,
  "optimizer": "Adam",
  "algorithm": "ResNet50",
  "model_status": "training",
  "model_path": "/models/exp_a_v1.pth",
  "description": "基于ResNet50的联邦学习模型"
}
```

**参数说明**:
| 字段名               | 类型    | 必须 | 说明                  | 示例                |
| -------------------- | ------- | ---- | --------------------- | ------------------- |
| model_name           | string  | 是   | 模型名称              | "实验模型A"         |
| algorithm            | string  | 是   | 使用的算法            | "ResNet50"          |
| model_version        | string  | 否   | 模型版本，默认"1.0.0" | "1.0.0"             |
| learning_rate        | number  | 否   | 学习率                | 0.001               |
| epochs               | integer | 否   | 训练轮次              | 100                 |
| aggregation_strategy | string  | 否   | 聚合策略              | "FedAvg"            |
| batch_size           | integer | 否   | 批次大小              | 32                  |
| optimizer            | string  | 否   | 优化器                | "Adam"              |
| model_status         | string  | 否   | 模型状态              | "training"          |
| model_path           | string  | 否   | 模型文件路径          | "/models/exp_a.pth" |
| description          | string  | 否   | 模型描述              | "这是一个测试模型"  |

### 响应示例

**成功响应**:
```json
{
  "code": 200,
  "message": "模型创建成功",
  "data": {
    "model": {
      "model_id": 1,
      "model_name": "实验模型A",
      "model_version": "1.0.0",
      "learning_rate": 0.001,
      "epochs": 100,
      "aggregation_strategy": "FedAvg",
      "batch_size": 32,
      "optimizer": "Adam",
      "algorithm": "ResNet50",
      "model_status": "training",
      "model_path": "/models/exp_a_v1.pth",
      "description": "基于ResNet50的联邦学习模型",
      "created_time": "2024-01-15 10:00:00",
      "updated_time": "2024-01-15 10:00:00"
    },
    "message": "模型创建成功"
  }
}
```

**错误响应**:
```json
{
  "code": 400,
  "message": "模型名称和版本已存在",
  "data": null
}
```

## 2. 查询模型列表接口

### 接口说明
获取模型列表，支持分页、搜索、筛选和排序

### 请求信息
- **URL**: `GET /api/models`
- **Content-Type**: `application/json`
- **认证**: 需要Bearer Token

### 查询参数
| 参数名       | 类型    | 必须 | 说明               | 默认值         | 示例         |
| ------------ | ------- | ---- | ------------------ | -------------- | ------------ |
| page         | integer | 否   | 页码               | 1              | 1            |
| pageSize     | integer | 否   | 每页大小           | 10             | 20           |
| model_name   | string  | 否   | 模型名称搜索关键词 | ""             | "实验"       |
| model_status | string  | 否   | 模型状态筛选       | ""             | "training"   |
| sort_by      | string  | 否   | 排序字段           | "created_time" | "model_name" |
| sort_order   | string  | 否   | 排序方向           | "desc"         | "asc"        |

### 响应示例

**成功响应**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "model_id": 1,
        "model_name": "实验模型A",
        "model_version": "1.0.0",
        "learning_rate": 0.001,
        "epochs": 100,
        "aggregation_strategy": "FedAvg",
        "batch_size": 32,
        "optimizer": "Adam",
        "algorithm": "ResNet50",
        "model_status": "training",
        "model_path": "/models/exp_a_v1.pth",
        "description": "基于ResNet50的联邦学习模型",
        "created_time": "2024-01-15 10:00:00",
        "updated_time": "2024-01-15 10:00:00"
      },
      {
        "model_id": 2,
        "model_name": "实验模型B",
        "model_version": "1.0.0",
        "learning_rate": 0.0005,
        "epochs": 80,
        "aggregation_strategy": "FedMA",
        "batch_size": 16,
        "optimizer": "SGD",
        "algorithm": "DenseNet121",
        "model_status": "completed",
        "model_path": "/models/exp_b_v1.pth",
        "description": "基于DenseNet121的联邦学习模型",
        "created_time": "2024-01-14 15:30:00",
        "updated_time": "2024-01-14 16:00:00"
      }
    ],
    "pagination": {
      "currentPage": 1,
      "pageSize": 10,
      "totalCount": 25,
      "totalPages": 3,
      "hasPrev": false,
      "hasNext": true
    }
    
  }
}
```

## 3. 获取模型详情接口

### 接口说明
获取指定模型的详细信息

### 请求信息
- **URL**: `GET /api/models/{model_id}`
- **Content-Type**: `application/json`
- **认证**: 需要Bearer Token

### 路径参数
| 参数名   | 类型    | 必须 | 说明   |
| -------- | ------- | ---- | ------ |
| model_id | integer | 是   | 模型ID |

### 响应示例

**成功响应**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "model": {
      "model_id": 1,
      "model_name": "实验模型A",
      "model_version": "1.0.0",
      "learning_rate": 0.001,
      "epochs": 100,
      "aggregation_strategy": "FedAvg",
      "batch_size": 32,
      "optimizer": "Adam",
      "algorithm": "ResNet50",
      "model_status": "training",
      "model_path": "/models/exp_a_v1.pth",
      "description": "基于ResNet50的联邦学习模型",
      "created_time": "2024-01-15 10:00:00",
      "updated_time": "2024-01-15 10:00:00"
    }
  }
}
```

**错误响应**:
```json
{
  "code": 404,
  "message": "模型不存在",
  "data": null
}
```

## 4. 更新模型接口

### 接口说明
更新模型配置信息

### 请求信息
- **URL**: `PUT /api/models/{model_id}`
- **Content-Type**: `application/json`
- **认证**: 需要Bearer Token

### 路径参数
| 参数名   | 类型    | 必须 | 说明   |
| -------- | ------- | ---- | ------ |
| model_id | integer | 是   | 模型ID |

### 请求参数
```json
{
  "model_name": "实验模型A-更新",
  "learning_rate": 0.0008,
  "epochs": 120,
  "model_status": "completed",
  "description": "更新后的模型描述"
}
```

**参数说明**:
| 字段名               | 类型    | 必须 | 说明         |
| -------------------- | ------- | ---- | ------------ |
| model_name           | string  | 否   | 模型名称     |
| model_version        | string  | 否   | 模型版本     |
| learning_rate        | number  | 否   | 学习率       |
| epochs               | integer | 否   | 训练轮次     |
| aggregation_strategy | string  | 否   | 聚合策略     |
| batch_size           | integer | 否   | 批次大小     |
| optimizer            | string  | 否   | 优化器       |
| algorithm            | string  | 否   | 使用的算法   |
| model_status         | string  | 否   | 模型状态     |
| model_path           | string  | 否   | 模型文件路径 |
| description          | string  | 否   | 模型描述     |

### 响应示例

**成功响应**:
```json
{
  "code": 200,
  "message": "模型更新成功",
  "data": {
    "model": {
      "model_id": 1,
      "model_name": "实验模型A-更新",
      "model_version": "1.0.0",
      "learning_rate": 0.0008,
      "epochs": 120,
      "aggregation_strategy": "FedAvg",
      "batch_size": 32,
      "optimizer": "Adam",
      "algorithm": "ResNet50",
      "model_status": "completed",
      "model_path": "/models/exp_a_v1.pth",
      "description": "更新后的模型描述",
      "created_time": "2024-01-15 10:00:00",
      "updated_time": "2024-01-15 11:30:00"
    },
    "message": "模型更新成功"
  }
}
```

## 5. 删除模型接口

### 接口说明
软删除指定模型

### 请求信息
- **URL**: `DELETE /api/models/{model_id}`
- **Content-Type**: `application/json`
- **认证**: 需要Bearer Token

### 路径参数
| 参数名   | 类型    | 必须 | 说明   |
| -------- | ------- | ---- | ------ |
| model_id | integer | 是   | 模型ID |

### 响应示例

**成功响应**:
```json
{
  "code": 200,
  "message": "模型删除成功",
  "data": null
}
```

**错误响应**:
```json
{
  "code": 404,
  "message": "模型不存在",
  "data": null
}
```

## 6. 获取模型选项接口

### 接口说明
获取模型相关的选项列表（用于前端下拉选择）

### 请求信息
- **URL**: `GET /api/models/options`
- **Content-Type**: `application/json`
- **认证**: 需要Bearer Token

### 响应示例

**成功响应**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "model_status": [
      "training",
      "completed",
      "failed",
      "stopped"
    ],
    "aggregation_strategy": [
      "FedAvg",
      "FedMA",
      "FedProx",
      "FedNova",
      "SCAFFOLD"
    ],
    "optimizer": [
      "SGD",
      "Adam",
      "AdamW",
      "RMSprop",
      "Adagrad"
    ]
  }
}
```

## 字段枚举值说明

### 模型状态 (model_status)
| 值        | 说明     |
| --------- | -------- |
| training  | 训练中   |
| completed | 已完成   |
| failed    | 训练失败 |
| stopped   | 已停止   |

### 聚合策略 (aggregation_strategy)
| 值       | 说明             |
| -------- | ---------------- |
| FedAvg   | 联邦平均         |
| FedMA    | 联邦模型平均     |
| FedProx  | 联邦近端优化     |
| FedNova  | 联邦归一化平均   |
| SCAFFOLD | 控制变量联邦学习 |

### 优化器 (optimizer)
| 值      | 说明                   |
| ------- | ---------------------- |
| SGD     | 随机梯度下降           |
| Adam    | 自适应矩估计           |
| AdamW   | Adam with Weight Decay |
| RMSprop | 均方根传播             |
| Adagrad | 自适应梯度算法         |

## 错误码说明

| 错误码 | 说明           | 可能原因                   |
| ------ | -------------- | -------------------------- |
| 200    | 成功           | 请求处理成功               |
| 400    | 请求参数错误   | 缺少必填字段、参数格式错误 |
| 401    | 未授权         | Token无效或过期            |
| 404    | 资源不存在     | 模型ID不存在               |
| 500    | 服务器内部错误 | 数据库连接失败等           |

## 前端调用示例

### 创建模型
```javascript
const createModel = async (modelData) => {
    const response = await fetch('/api/models', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + token
        },
        body: JSON.stringify(modelData)
    });
    return await response.json();
};

// 使用示例
const result = await createModel({
    model_name: '实验模型D',
    model_version: '1.0.0',
    learning_rate: 0.001,
    epochs: 100,
    aggregation_strategy: 'FedAvg',
    batch_size: 32,
    optimizer: 'Adam',
    algorithm: 'ResNet50',
    description: '这是一个测试模型'
});
```

### 查询模型列表
```javascript
const getModels = async (filters = {}) => {
    const params = new URLSearchParams(filters);
    const response = await fetch(`/api/models?${params}`, {
        headers: {
            'Authorization': 'Bearer ' + token
        }
    });
    return await response.json();
};

// 使用示例
const result = await getModels({
    model_name: '实验',
    model_status: 'training',
    page: 1,
    pageSize: 10,
    sort_by: 'created_time',
    sort_order: 'desc'
});
```

### 更新模型
```javascript
const updateModel = async (modelId, updateData) => {
    const response = await fetch(`/api/models/${modelId}`, {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + token
        },
        body: JSON.stringify(updateData)
    });
    return await response.json();
};

// 使用示例
await updateModel(1, {
    model_name: '实验模型A-更新',
    epochs: 120,
    model_status: 'completed'
});
```

这份接口文档提供了完整的请求参数、响应格式和示例，方便前后端开发人员参考和使用。

# 代码实现